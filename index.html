<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Fuel Log Generator</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* Custom styles for Inter font (if needed, Bootstrap uses system fonts by default) */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ensure rounded corners on all elements as per instructions (Bootstrap handles most of this) */
        .form-control, .btn, .card, table {
            border-radius: 0.5rem !important; /* Apply rounded corners explicitly */
        }
        /* Custom styling for the table header to match blue-600 from previous version */
        .table thead th {
            background-color: #2563eb; /* A shade of blue similar to Tailwind's blue-600 */
            color: white;
        }
        /* Custom styling for the table footer to match blue-500 from previous version */
        .table tfoot td {
            background-color: #3b82f6; /* A shade of blue similar to Tailwind's blue-500 */
            color: white;
        }
    </style>
</head>
<body class="bg-light d-flex align-items-center justify-content-center min-vh-100 py-4 py-sm-5">
    <div class="container-md bg-white p-4 p-sm-5 rounded-3 shadow-lg">
        <h1 class="text-center text-primary mb-4 mb-sm-5">
            Dynamic Fuel Log Generator
        </h1>

        <!-- Input Form -->
        <div class="row g-4 mb-4">
            <div class="col-12 col-md-6">
                <label for="startDate" class="form-label fw-bold text-secondary">
                    Start Date:
                </label>
                <input
                    type="date"
                    id="startDate"
                    class="form-control"
                    value="2024-07-01"
                />
            </div>
            <div class="col-12 col-md-6">
                <label for="endDate" class="form-label fw-bold text-secondary">
                    End Date:
                </label>
                <input
                    type="date"
                    id="endDate"
                    class="form-control"
                    value="2025-06-30"
                />
            </div>
            <div class="col-12 col-md-6">
                <label for="maxTankCapacity" class="form-label fw-bold text-secondary">
                    Max Tank Capacity (Gallons):
                </label>
                <input
                    type="number"
                    id="maxTankCapacity"
                    class="form-control"
                    value="26"
                    min="1"
                />
            </div>
            <div class="col-12 col-md-6">
                <label for="totalGallonsToPurchase" class="form-label fw-bold text-secondary">
                    Total Gallons to Purchase:
                </label>
                <input
                    type="number"
                    id="totalGallonsToPurchase"
                    class="form-control"
                    value="2450"
                    min="1"
                />
            </div>
            <div class="col-12">
                <label for="gasStationsInput" class="form-label fw-bold text-secondary">
                    Gas Stations (one per line):
                </label>
                <textarea
                    id="gasStationsInput"
                    rows="5"
                    class="form-control"
                    placeholder="e.g., Shell, 123 Main St"
                >Circle K, 35 S Grand Blvd, St Louis, Missouri, 63103
BP, 1815 Arsenal, St Louis, Missouri, 63118
Moto, 3120 Mississippi Ave, Sauget, Illinois, 6220
Love's, 6124 N Broadway, St Louis, Missouri, 63147
Circle K, 1514 Hampton Ave, St Louis, Missouri, 63139
Zoom, 1300 N Tucker Blvd, St. Louis, Missouri, 63106
ZX, 1007 S Broadway, St Louis, Missouri, 63103
Shell, 721 N Tucker Blvd, St Louis, Missouri, 63101
QuikTrip, 2600 Chouteau Ave, St Louis, Missouri, 63103
Phillips 66, 1655 S Jefferson Ave, St Louis, Missouri, 63104</textarea>
            </div>
        </div>

        <div id="errorMessage" class="alert alert-danger mb-4 d-none" role="alert">
            <strong class="me-2">Error!</strong>
            <span id="errorMessageText"></span>
        </div>

        <div class="d-flex justify-content-center gap-3 mb-4">
            <button
                id="generateLogBtn"
                class="btn btn-primary btn-lg shadow-sm"
            >
                Generate Fuel Log
            </button>
            <button
                id="resetBtn"
                class="btn btn-secondary btn-lg shadow-sm"
            >
                Reset
            </button>
        </div>

        <!-- Display Table -->
        <div id="tableContainer" class="table-responsive mb-4 d-none">
            <table class="table table-striped table-bordered rounded-3 shadow-sm">
                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Gallons Purchased</th>
                        <th scope="col">Gas Station</th>
                    </tr>
                </thead>
                <tbody id="purchaseLogTableBody">
                    <!-- Table rows will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr>
                        <td class="fw-bold">Total Gallons:</td>
                        <td id="totalGallonsInLog" class="fw-bold"></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // DOM element references
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const maxTankCapacityInput = document.getElementById('maxTankCapacity');
        const totalGallonsToPurchaseInput = document.getElementById('totalGallonsToPurchase');
        const gasStationsInput = document.getElementById('gasStationsInput');
        const generateLogBtn = document.getElementById('generateLogBtn');
        const resetBtn = document.getElementById('resetBtn'); // New reset button
        const errorMessageDiv = document.getElementById('errorMessage');
        const errorMessageText = document.getElementById('errorMessageText');
        const tableContainer = document.getElementById('tableContainer');
        const purchaseLogTableBody = document.getElementById('purchaseLogTableBody');
        const totalGallonsInLogSpan = document.getElementById('totalGallonsInLog');

        // Helper for random sampling without replacement
        function randomSample(array, size) {
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, size);
        }

        // Simple random number generator (Python's random.uniform equivalent)
        const random = {
            uniform: (min, max) => Math.random() * (max - min) + min,
            choice: (array) => array[Math.floor(Math.random() * array.length)]
        };

        // Function to display error messages
        function showError(message) {
            errorMessageText.textContent = message;
            errorMessageDiv.classList.remove('d-none'); // Use Bootstrap's d-none
            tableContainer.classList.add('d-none'); // Hide table if there's an error
        }

        // Function to hide error messages
        function hideError() {
            errorMessageDiv.classList.add('d-none');
            errorMessageText.textContent = '';
        }

        // Function to generate the fuel log
        function generateLog() {
            hideError(); // Clear previous errors

            const startDateStr = startDateInput.value;
            const endDateStr = endDateInput.value;
            const maxTankCapacity = parseFloat(maxTankCapacityInput.value);
            const totalGallonsToPurchase = parseFloat(totalGallonsToPurchaseInput.value);
            const gasStations = gasStationsInput.value.split('\n')
                                .map(s => s.trim())
                                .filter(s => s.length > 0);

            const parsedStartDate = new Date(startDateStr);
            const parsedEndDate = new Date(endDateStr);

            // --- Input Validation ---
            if (isNaN(parsedStartDate.getTime()) || isNaN(parsedEndDate.getTime())) {
                showError('Please enter valid start and end dates.');
                return;
            }
            if (parsedStartDate >= parsedEndDate) {
                showError('End Date must be after Start Date.');
                return;
            }
            if (isNaN(maxTankCapacity) || maxTankCapacity <= 0) {
                showError('Max Tank Capacity must be a positive number.');
                return;
            }
            if (isNaN(totalGallonsToPurchase) || totalGallonsToPurchase <= 0) {
                showError('Total Gallons to Purchase must be a positive number.');
                return;
            }
            if (gasStations.length === 0) {
                showError('Please enter at least one gas station.');
                return;
            }
            if (totalGallonsToPurchase < maxTankCapacity) {
                showError('Total gallons to purchase should generally be greater than or equal to max tank capacity.');
                return;
            }

            // --- Log Generation Logic ---
            const log = [];
            const minFillAmount = 5; // Minimum realistic fill amount

            // Calculate the number of days in the range
            const diffTime = Math.abs(parsedEndDate.getTime() - parsedStartDate.getTime());
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // Estimate a reasonable number of purchases to distribute the total gallons
            const estimatedAvgFill = (minFillAmount + maxTankCapacity) / 2;
            let numPurchases = Math.ceil(totalGallonsToPurchase / estimatedAvgFill);

            // Ensure we don't try to make more purchases than there are days, or too few
            numPurchases = Math.max(Math.min(numPurchases, diffDays), Math.ceil(totalGallonsToPurchase / maxTankCapacity));
            numPurchases = Math.max(numPurchases, 1); // Ensure at least one purchase if totalGallonsToPurchase > 0

            // Generate potential dates
            const allPossibleDates = [];
            for (let i = 0; i <= diffDays; i++) {
                const date = new Date(parsedStartDate);
                date.setDate(parsedStartDate.getDate() + i);
                allPossibleDates.push(date);
            }

            // Randomly select distinct dates for the purchases
            let selectedDates = [];
            if (numPurchases <= allPossibleDates.length) {
                selectedDates = randomSample(allPossibleDates, numPurchases).sort((a, b) => a.getTime() - b.getTime());
            } else {
                // If more purchases than days, assign multiple purchases to some days
                selectedDates = Array(numPurchases).fill(0).map(() => {
                    const randomDay = Math.floor(Math.random() * diffDays);
                    const date = new Date(parsedStartDate);
                    date.setDate(parsedStartDate.getDate() + randomDay);
                    return date;
                }).sort((a, b) => a.getTime() - b.getTime());
            }

            // Generate random fill amounts
            let generatedGallons = Array(numPurchases).fill(0).map(() =>
                random.uniform(minFillAmount, maxTankCapacity)
            );

            // Scale generated gallons to match the total, and adjust for min/max capacity
            const currentSum = generatedGallons.reduce((sum, val) => sum + val, 0);
            const scaleFactor = totalGallonsToPurchase / currentSum;

            generatedGallons = generatedGallons.map(g => {
                let scaledG = g * scaleFactor;
                return Math.max(minFillAmount, Math.min(maxTankCapacity, scaledG));
            });

            // Final fine-tuning to hit the target total exactly due to floating point and capping
            let finalSum = generatedGallons.reduce((sum, val) => sum + val, 0);
            let diff = totalGallonsToPurchase - finalSum;
            let iterationCount = 0;
            const maxIterations = 100; // Prevent infinite loop for tiny differences

            while (Math.abs(diff) > 0.1 && iterationCount < maxIterations) { // Adjust if difference is > 0.1 gallons
                const adjustmentPerItem = diff / numPurchases;
                generatedGallons = generatedGallons.map(g => {
                    let adjustedG = g + adjustmentPerItem;
                    return Math.max(minFillAmount, Math.min(maxTankCapacity, adjustedG));
                });
                finalSum = generatedGallons.reduce((sum, val) => sum + val, 0);
                diff = totalGallonsToPurchase - finalSum;
                iterationCount++;
            }

            // Populate the log
            let runningTotalForDisplay = 0;
            purchaseLogTableBody.innerHTML = ''; // Clear previous table rows

            for (let i = 0; i < numPurchases; i++) {
                const purchaseDate = selectedDates[i];
                const gallons = parseFloat(generatedGallons[i].toFixed(1)); // Round to 1 decimal place
                const station = random.choice(gasStations);

                // Add to log array (optional, but good for internal state if needed later)
                log.push({
                    date: purchaseDate.toISOString().split('T')[0], // Format as YYYY-MM-DD
                    gallons: gallons,
                    station: station
                });

                // Dynamically create table row
                const row = purchaseLogTableBody.insertRow();
                const dateCell = row.insertCell();
                const gallonsCell = row.insertCell();
                const stationCell = row.insertCell();

                dateCell.textContent = purchaseDate.toISOString().split('T')[0];
                gallonsCell.textContent = gallons.toFixed(1);
                stationCell.textContent = station;

                runningTotalForDisplay += gallons;
            }

            // Update total gallons display
            totalGallonsInLogSpan.textContent = runningTotalForDisplay.toFixed(1) + ' gallons';
            tableContainer.classList.remove('d-none'); // Show the table
        }

        // Function to reset inputs and hide table
        function resetForm() {
            startDateInput.value = "2024-07-01";
            endDateInput.value = "2025-06-30";
            maxTankCapacityInput.value = "26";
            totalGallonsToPurchaseInput.value = "2450";
            gasStationsInput.value = `Circle K, 35 S Grand Blvd, St Louis, Missouri, 63103
BP, 1815 Arsenal, St Louis, Missouri, 63118
Moto, 3120 Mississippi Ave, Sauget, Illinois, 6220
Love's, 6124 N Broadway, St Louis, Missouri, 63147
Circle K, 1514 Hampton Ave, St Louis, Missouri, 63139
Zoom, 1300 N Tucker Blvd, St. Louis, Missouri, 63106
ZX, 1007 S Broadway, St Louis, Missouri, 63103
Shell, 721 N Tucker Blvd, St Louis, Missouri, 63101
QuikTrip, 2600 Chouteau Ave, St Louis, Missouri, 63103
Phillips 66, 1655 S Jefferson Ave, St Louis, Missouri, 63104`;
            purchaseLogTableBody.innerHTML = ''; // Clear table rows
            tableContainer.classList.add('d-none'); // Hide table
            hideError(); // Hide any error messages
        }


        // Event listeners
        generateLogBtn.addEventListener('click', generateLog);
        resetBtn.addEventListener('click', resetForm); // Add event listener for reset button

        // Initial generation on page load
        document.addEventListener('DOMContentLoaded', generateLog);

    </script>
</body>
</html>
